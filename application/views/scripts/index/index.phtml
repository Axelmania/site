<?php
// some variable initiation
$url_tag_cloud = $this->url(array('controller' => 'tag',
                                  'action' => 'index',
                                  'language' => $this->language), 
                            'lang_default', true);
    
$url_sign_up = $this->url(array('controller' => 'account',
                                'action' => 'register',
                                'language' => $this->language), 
                          'lang_default', true);
    
$url_more = $this->url(array('controller' => 'search',
                              'action' => 'result',
                              'page' => '2',
                              'language' => $this->language), 
                        'lang_default', true);
?>

<h3 class="recent_posts"><?php echo $this->translate('index-recent-posts'); ?></h3>
			
<!-- Small hack to force a small space between the h2 and content... might help the Symbian -browsers a bit -->
<div style="height: 2px;"></div>

<div class="user_content_list" style="padding: 0px; margin: 0px; overflow:hidden;">

<?php if (isset($this->recentposts) && $this->recentposts != null && $this->recentposts != ''): ?>

    <?php foreach($this->recentposts as $post): ?>
    
    <div class="user_content_row">
        <div class="user_image_list">
            <img src="<?php echo $this->url(array('controller' => 'account',
                                                  'action' => 'profilethumb',
                                                  'id' => $post['id_usr'],
                                                  'language' => $this->language,
                                                  'thumb' => 'true'),
                                           'lang_default', true)?>" 
                alt="User image" class="profile_image_smallsize smallsize_<?php echo $post['key_cty'];?>_border" />
        </div>
        
        <div class="user_summary_list_without_stats">
            <?php
                $url_post = $this->url(array('content_id' => $post['id_cnt'],
                                             'language' => $this->language), 
                                       'content_shortview', true); 
                
                $url_user = $this->url(array('controller' => 'account',
                                             'action' => 'view', 
                                             'user' => $post['login_name_usr'],
                                             'language' => $this->language),
                                       'lang_default', true);
            ?>
            <span class="summary_topic">
                <a href="<?php echo $url_user; ?>">
                    <?php echo $post['login_name_usr']; ?>
                </a>
                : 
                <b>
                    <a href="<?php echo $url_post;?>">
                        <?php echo $post['title_cnt'];?>
                    </a>
                </b>
            </span>
            
            <br />
            
            <span class="summary_leadtext">
                <?php echo $post['lead_cnt']; ?>
            </span>
            
            <br />
            
            <span class="summary_tags">
                <b>
                    <a href="<?php echo $url_tag_cloud; ?>">
                        Tags
                    </a>:
                </b>
                <?php foreach ($post['tags'] as $tag): ?>
                <a href="<?php echo $this->url(array('controller' => 'tag',
                                                     'action' => 'view',
                                                     'id' => $tag['id_tag'],
                                                     'language' => $this->language), 
                                               'lang_default', true);?>">
                    <?php echo $tag['name_tag']; ?>
                </a>
                <?php endforeach; ?>
           </span>
        </div>
        
        <div style="clear: both;"></div>
        
    </div>
    
    <?php endforeach; ?>
    
<?php endif; ?>

    <div class="user_content_spacer">
        <img src="<?php echo $this->baseUrl('/images/gray_dot_line_500.png'); ?>" alt="Massidea.org" />
    </div>
    
    <div style="margin-top: 10px; margin-left: 220px;">
        <h3>
            <a href="<?php echo $url_more; ?>">
                <?php echo $this->translate('index-view-more'); ?>
            </a>
        </h3>
    </div>
</div>

<?php 
/*
Assign the partial view to the layout :) 
If there is nothing, the layout just prints nothing. 
However, if you assign a file that does not exist, the site will 
throw an application error instantly, so be careful!

Commented to fix temporary problem, will be researched further later
*/
//$this->layout()->right_side = $this->partial('partials/index.phtml'); 
?>
<div class="right_side" style="padding: 0px; margin: 0px; margin-top: -52px;">
    <!-- For some mystical reason, paragraphs seem to need an empty style-attribute in order to extend a CSS -class -->
    <h4 style="margin-top: 8px; margin-bottom: 6px;">
        <?php echo $this->translate('index-what-is'); ?>
    </h4>
        <div class="top_right_box">
            <?php echo $this->translate('index-what-is-long'); ?>
            <?php // <span class="top_right_box_links"><a href="#"> echo $this->translate('index-learn-more'); </a></span> ?>
        </div>
        
    <?php if(!$this->isLoggedIn): ?>
    <p id="sign_up_now" style="padding-bottom: 10px;" class="top_right_box_links">
        <b>
            <a href="<?php echo $url_sign_up; ?>">
                <?php echo $this->translate('index-sigup')?>
            </a>
        </b>
    </p>
    <?php endif; ?>
    
    <h3 style="margin-top: 5px; margin-bottom: 0; padding: 0;">
        <?php echo $this->translate('index-most-popular')?>
        <a href="<?php echo $url_tag_cloud; ?>">
            <?php echo $this->translate('index-tags')?>
        </a>
    </h3>
    
    <img src="<?php echo $this->baseUrl('/images/gray_dot_line_200.png'); ?>" alt="Massidea.org" />
    
    <div class="tag_cloud">
        <?php foreach ($this->poptags as $tag): ?>
            <a href="<?php echo $this->url(array('controller' => 'tag',
                                                 'action' => 'view',
                                                 'id' => $tag['id_tag'],
                                                 'language' => $this->language),
                                           'lang_default', true);?>" 
                style="font-size:<?php echo $tag['tag_size']?>%">
                <?php echo stripslashes($tag['name_tag']); ?>
            </a>
        <?php endforeach; ?>
        
        <p id="show_all_tags" style="padding: 0px; margin-top: 10px;" class="top_right_box_links">
            <a href="<?php echo $url_tag_cloud; ?>">
                <?php echo $this->translate('index-show-all')?>
            </a>
        </p>
    </div>
    
    <img src="<?php echo $this->baseUrl('/images/gray_dot_line_200.png'); ?>" alt="Massidea.org" />
    
    <p id="most_active_users" style="padding: 0px;" class="top_right_box_links">
        <?php echo $this->translate('index-most-active')?>
        <a href="#">
            <?php echo $this->translate('index-users')?>
        </a>
    </p>
    
    <img src="<?php echo $this->baseUrl('/images/gray_dot_line_200.png'); ?>" alt="Massidea.org" />
    
    <div class="top_right_box_links_users">
        <?php foreach ($this->activeusers as $user): ?>
        
        <a href="<?php echo $this->url(array('controller' => 'account',
                                'action' => 'view', 
                                'user' => $user['login_name_usr'],
                                'language' => $this->language),
                                'lang_default', true);?>">
            <?php echo $user['login_name_usr']; ?>
        </a> 
        (<?php echo $user['count']; ?>)
        <br />
        
        <?php endforeach; ?>
    </div>
    
    <div class="top_right_box_links_show_all_users">
        <a href="#">
            <?php echo $this->translate('index-show-all')?>
            <?php echo $this->translate('index-users')?>
        </a>
    </div>
    
    <img src="<?php echo $this->baseUrl('/images/gray_dot_line_200.png'); ?>" alt="Massidea.org" />
    
    <div class="massidea_dev_info">
        <?php echo $this->translate('index-opensource')?>
    </div>
</div>